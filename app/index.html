<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebGL GPU Particles 2</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div id="webgl-container" class="gradient-bg-cyan-black">
        <canvas id="webgl-canvas"></canvas>
    </div>
    <div id="debug-box"></div>
</body>

<script type="text/javascript" src="js/lib/jquery-2.1.3.js"></script>
<script type="text/javascript" src="js/lib/dat.gui.min.js"></script>
<script type="text/javascript" src="js/lib/three70.js"></script>
<script type="text/javascript" src="js/lib/Stats.js"></script>
<script type="text/javascript" src="js/lib/Clock.js"></script>
<script type="text/javascript" src="js/lib/TrackballControls.js"></script>
<script type="text/javascript" src="js/lib/OrbitControls.js"></script>
<script type="text/javascript" src="js/lib/CopyShader.js"></script>

<script type="text/javascript" src="js/src/RenderContext.js"></script>
<script type="text/javascript" src="js/src/App.js"></script>
<script type="text/javascript" src="js/src/UpdateLoop.js"></script>
<script type="text/javascript" src="js/src/Utils.js"></script>
<script type="text/javascript" src="js/src/Mouse.js"></script>
<script type="text/javascript" src="js/src/ShaderPass.js"></script>
<script type="text/javascript" src="js/src/SimulationRenderer.js"></script>
<script type="text/javascript" src="js/src/ParticleSimulation.js"></script>

<script type="text/javascript" src="js/src/shaders/ShaderChunks.js"></script>
<script type="text/javascript" src="js/src/shaders/SimShader.js"></script>
<script type="text/javascript" src="js/src/shaders/SimInitShader.js"></script>
<script type="text/javascript" src="js/src/shaders/ParticleShader.js"></script>
<script type="text/javascript" src="js/src/shaders/SimDebugShader.js"></script>

<script>
(function(){

    var RoseGalaxy = function() {
        this.size = 512;
        this.simMat = createShaderMaterial(SimShader);
        var _drawMat = this.drawMat = createShaderMaterial(ParticleShader);
        _drawMat.uniforms.uColor.value = new THREE.Vector4(1.0, 0.5, 1.0, 0.2);
        this.update = function(dt, t) {
            _drawMat.uniforms.uTime.value = t;
        };
    };

    var Basic = function() {
        this.size = Utils.isMobile ? 128 : 512;
        var _drawMat = this.drawMat = createShaderMaterial(BasicParticleShader);
        var _color = new THREE.Color(1.0, 0.5, 0.3);
        var _alpha = 0.3;
        this.update = function(dt, t) {
            _color.offsetHSL(0.1*dt, 0.0, 0.0);
            _drawMat.uniforms.uColor.value.set(_color.r, _color.g, _color.b, _alpha);
        };
    };

    var Sphere = function() {
        this.size = Utils.isMobile ? 128 : 512;
        this.simMat = createShaderMaterial(SphereSimShader);
        var _drawMat = this.drawMat = createShaderMaterial(Utils.isMobile ? BasicParticleShader : ParticleShader);
        _drawMat.uniforms.uColor.value = new THREE.Vector4(1.0, 0.5, 1.0, 0.2);
        this.update = Utils.isMobile ? undefined : function(dt, t) {
            _drawMat.uniforms.uTime.value = t;
        };
    };

    var preset;
    if (Utils.isMobile)
        preset = Basic;
    else
        preset = RoseGalaxy;

    var hashPresets = {
        basic: Basic,
        sphere: Sphere,
    };
    var hashLookup = hashPresets[window.location.hash.substr(1)];
    if (hashLookup) preset = hashLookup;
    window.onhashchange = function() {
        window.location.reload();
    };

    var app = new App(new preset());
})();
</script>

</html>